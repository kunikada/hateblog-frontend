# 検索結果

## 画面概要
- **画面名**: 検索結果
- **URL**: `/search/:search`
- **URLパラメータ**:
  - `search`: 検索キーワード（必須、URLパスに含まれる）
  - `min_users`: 最低ブックマーク件数フィルタ（オプション、デフォルト: 5）
  - `page`: ページ番号（デフォルト: 1）
- **目的**: キーワード検索結果を表示（タイトル・抜粋・タグを全文検索）

### URL例
- `/search/Go言語` - 「Go言語」の検索結果
- `/search/React` - 「React」の検索結果

## レイアウト構成

### ページヘッダー
- ページタイトル: "検索結果"
- 検索キーワード表示
  - 例: "「Go言語」の検索結果"
- 検索結果件数表示
  - 例: "123 件見つかりました"

### 検索フォーム（再検索用）
- テキスト入力フィールド（初期値: 検索キーワード）
- 検索ボタン
- 検索種別セレクタ（将来的な拡張）
  - 全文検索（デフォルト）
  - タイトル検索
  - タグ検索

### フィルタバー
- はてなブックマーク件数閾値チップ
  - 5 users / 10 users / 50 users / 100 users / 500 users / 1000 users
  - 複数選択可能（OR条件）
  - クリアボタン
- PC: 水平配置
- SP: 横スクロールチップ

### メインコンテンツ
- 検索結果エントリーカードリスト
  - **ハイライト機能**: 検索キーワードを太字またはハイライト表示
  - PC: 2列グリッド
  - SP: 1列リスト
- 読み込み中: スケルトンスクリーン表示

### ページネーション
- 前のページ / 次のページボタン
- ページ番号表示（現在ページ / 総ページ数）

## エントリーカード構成

新着順エントリー一覧と同じ。詳細は [03_entries_new.md](./03_entries_new.md) を参照。

### 特記事項（検索結果専用）
- タイトル・抜粋内の検索キーワードをハイライト表示
  - 太字（`<strong>`）または背景色（黄色）でマーク
- 検索スコア表示（オプション）
  - 検索結果の関連度スコアを表示

## API連携

### 初期表示（検索実行）
```
GET /api/v1/search?q={keyword}&min_users={number}&limit=25&offset=0
```

#### リクエストパラメータ
- `q`: 検索キーワード（必須、1-500文字）
- `min_users`: 最低ブックマーク件数（5/10/50/100/500/1000）
- `limit`: 取得件数（デフォルト: 25）
- `offset`: オフセット（ページネーション用）

#### レスポンス
```json
{
  "query": "Go言語",
  "entries": [
    {
      "id": "uuid",
      "title": "Go言語による高速なWeb API開発",
      "url": "https://example.com/article",
      "posted_at": "2025-01-05T10:30:00Z",
      "bookmark_count": 150,
      "excerpt": "Go言語を使ったWeb API開発の実践的なテクニックを紹介...",
      "tags": [
        {
          "tag_id": "uuid",
          "tag_name": "Go",
          "score": 0.95
        }
      ],
      "favicon_url": "https://www.google.com/s2/favicons?domain=example.com"
    }
  ],
  "total": 123,
  "limit": 25,
  "offset": 0
}
```

### クリック計測
新着順エントリー一覧と同じ。詳細は [03_entries_new.md](./03_entries_new.md) を参照。

## インタラクション

### 再検索
1. 検索フォームにキーワードを入力
2. 検索ボタンをクリック
3. `/search/{keyword}` に遷移
4. API再リクエスト

### 閾値フィルタ選択
新着順エントリー一覧と同じ。詳細は [03_entries_new.md](./03_entries_new.md) を参照。

### エントリーカードクリック
新着順エントリー一覧と同じ。詳細は [03_entries_new.md](./03_entries_new.md) を参照。

### ページネーション
新着順エントリー一覧と同じ。詳細は [03_entries_new.md](./03_entries_new.md) を参照。

## キーワードハイライト処理

検索キーワードをタイトル・抜粋内でハイライト表示:

```javascript
function highlightKeyword(text, keyword) {
  const regex = new RegExp(`(${keyword})`, 'gi');
  return text.replace(regex, '<strong class="highlight">$1</strong>');
}
```

## 状態管理

### ローカルステート
- 検索キーワード（query）
- 選択閾値フィルタ（minUsers）
- 現在ページ（page）
- 検索結果エントリーリスト（entries）
- 総件数（total）
- ローディング状態（isLoading）
- エラー状態（error）

### localStorage
- `searchHistory`: 検索履歴配列（オプション）
  - `{ keyword, searched_at }[]`

## デザインガイドライン

### 検索キーワード表示
- フォントサイズ: 24px
- フォントウェイト: Bold
- カラー: #333

### 検索結果件数表示
- フォントサイズ: 16px
- カラー: グレー（#666）

### キーワードハイライト
- 太字（`font-weight: bold`）
- 背景色: 黄色（#FFFF00、半透明）
- テキスト色: #333（黒）

### エントリーカード
新着順エントリー一覧と同じ。詳細は [03_entries_new.md](./03_entries_new.md) を参照。

## アクセシビリティ

- 検索フォーム: `<form role="search">`
- 検索結果件数: `aria-live="polite"`（動的更新時）
- ハイライト: `<mark>` タグまたは `<strong>` タグ
- キーボードナビゲーション対応

## パフォーマンス

- 初期表示: 2秒以内
- 検索フォームのデバウンス処理（300ms）
- Faviconの遅延読み込み
- 検索結果キャッシュ（同一キーワード・閾値の場合）

## エラーハンドリング

### APIエラー
- 400 Bad Request: "検索キーワードが正しくありません"
- 500 Server Error: "サーバーエラーが発生しました"
- エラーメッセージをトースト表示
- 再試行ボタン表示

### データなし
- "「{keyword}」に該当するエントリーがありませんでした"
- キーワードの変更を提案
- トップページへ戻るリンク表示

### キーワード未入力
- 検索ボタンをクリック時にバリデーションエラー表示
- "検索キーワードを入力してください"

## テスト観点

### 表示テスト
- [ ] ページタイトルが表示される
- [ ] 検索キーワードが表示される
- [ ] 検索結果件数が表示される
- [ ] 検索フォームが表示される（初期値: 検索キーワード）
- [ ] 閾値フィルタチップが表示される
- [ ] エントリーカードが表示される（25件）
- [ ] キーワードがハイライト表示される
- [ ] ページネーションが表示される

### 機能テスト
- [ ] 再検索が動作する
- [ ] 閾値フィルタを変更するとエントリーがフィルタされる
- [ ] エントリーカードクリックで元記事が新規タブで開く
- [ ] ページネーションが動作する
- [ ] キーワード未入力時にバリデーションエラーが表示される

### レスポンシブテスト
- [ ] PC表示で2列グリッド
- [ ] SP表示で1列リスト
- [ ] 検索フォームがレスポンシブ対応

### パフォーマンステスト
- [ ] 初期表示が2秒以内
- [ ] デバウンス処理が機能する

## 備考
- 検索結果は新着順エントリー一覧と多くの実装を共通化できる
- 全文検索はバックエンドの pg_bigm を使用
- 検索種別（全文/タイトル/タグ）の切り替えは将来的な拡張として検討
- 検索履歴機能は将来的な拡張として検討
