# アーカイブ（日選択）

## 画面概要
- **画面名**: アーカイブ（日選択）
- **URL**: `/archive/:year/:month`
- **URLパラメータ**:
  - `year`: 対象年（YYYY形式）
  - `month`: 対象月（MM形式、1-12）
  - `min_users`: 最低ブックマーク件数フィルタ（オプション、デフォルト: 5）
- **目的**: 指定年月の日別エントリー数を表示し、日を選択して新着/人気エントリー一覧へ遷移

## レイアウト構成

### パンくずリスト
- アーカイブ > 2025年 > 1月

### ページヘッダー
- ページタイトル: "2025年1月のアーカイブ"
- 月選択ナビゲーション
  - 前月ボタン
  - 年月表示（ドロップダウンまたはテキスト）
  - 翌月ボタン

### フィルタバー（オプション）
- はてなブックマーク件数閾値チップ
  - 5 users / 10 users / 50 users / 100 users / 500 users / 1000 users

### メインコンテンツ
- カレンダービュー または 日別リストビュー
- 各日のエントリー数を表示
- クリックで新着/人気エントリー一覧へ遷移

### 日別ビジュアライゼーション（オプション）
- 日別エントリー数のヒートマップ
- 日別エントリー数のバーグラフ

## カレンダービュー構成

### 表示要素
- 曜日ヘッダー（日〜土）
- 日付セル（1日〜月末まで）
  - 日付
  - エントリー数
  - 視覚的インジケーター（バッジ、背景色など）

### レイアウト
- 7列グリッド（日〜土）
- 週ごとの行（4-6行）

### ヒートマップ表示（オプション）
- エントリー数に応じて背景色を変更
  - 0件: 白/透明
  - 1-10件: 薄いブルー
  - 11-50件: ブルー
  - 51-100件: 濃いブルー
  - 101件以上: 最も濃いブルー

## 日リストビュー構成

### 表示要素
- 日付（例: "1日（月）"）
- エントリー数（例: "45 エントリー"）
- 新着/人気リンク
  - 新着順で見る
  - 人気順で見る

### レイアウト
- PC: 2-3列グリッド
- SP: 1列リスト

## API連携

### 初期表示（日別データ取得）
```
GET /api/v1/archive?year={year}&month={month}&min_users={number}
```

#### リクエストパラメータ
- `year`: 対象年（YYYY形式、必須）
- `month`: 対象月（MM形式、1-12、必須）
- `min_users`: 最低ブックマーク件数フィルタ（オプション、デフォルト: 5）

#### レスポンス
```json
{
  "year": 2025,
  "month": 1,
  "items": [
    { "date": "2025-01-01", "count": 45 },
    { "date": "2025-01-02", "count": 67 },
    { "date": "2025-01-03", "count": 123 },
    // ...
    { "date": "2025-01-31", "count": 89 }
  ]
}
```

## インタラクション

### 日付セルクリック（カレンダービュー）
1. 日付セルをクリック
2. オプション選択モーダル表示
   - 新着順で見る: `/entries/new?date={YYYYMMDD}`
   - 人気順で見る: `/entries/hot?date={YYYYMMDD}`

または

1. 日付セルをクリック
2. デフォルトで新着順エントリー一覧へ遷移: `/entries/new?date={YYYYMMDD}`

### 日リストビューのリンククリック
- 新着順で見る: `/entries/new?date={YYYYMMDD}` に遷移
- 人気順で見る: `/entries/hot?date={YYYYMMDD}` に遷移

### 前月/翌月ナビゲーション
- 前月ボタン: `year` と `month` を調整してページ再読み込み
- 翌月ボタン: `year` と `month` を調整してページ再読み込み
- 未来月（現在月より後）の場合は翌月ボタンを無効化

### 閾値フィルタ変更
1. チップをクリック
2. URLパラメータ更新: `?min_users={number}`
3. API再リクエスト

## 状態管理

### ローカルステート
- 対象年月（year, month）
- 日別データ（dailyData）
  - `{ date: string, count: number }[]`
- 選択閾値フィルタ（minUsers）
- 表示モード（viewMode: 'calendar' | 'list'）
- ローディング状態（isLoading）
- エラー状態（error）

### グローバルステート
- なし（ページ固有のデータ）

## デザインガイドライン

### カレンダービュー
- セルサイズ: 正方形（レスポンシブ）
- ボーダー: 1px solid #DDD
- 曜日ヘッダー: 背景色グレー、テキスト中央揃え

### 日付セル
- 日付: 左上に表示（14px）
- エントリー数: 中央に大きく表示（18px、Bold）
- ホバー時: 背景色を明るく、カーソルをポインターに
- 当日: ボーダーをHatebuブルーで強調
- エントリーなし: グレーアウト、クリック不可

### ヒートマップカラースケール
- 0件: #FFFFFF
- 1-10件: #E3F2FD
- 11-50件: #90CAF9
- 51-100件: #42A5F5
- 101件以上: #1976D2

### 日リストビュー
- 日カード: 白背景、ボーダー、パディング16px
- 日付表示: 24px、Bold
- エントリー数: 18px、Hatebuブルー

## アクセシビリティ

- パンくずリスト: `<nav aria-label="Breadcrumb">`
- カレンダー: `role="grid"`
- 日付セル: `role="gridcell"`、`aria-label="1月1日、45エントリー"`
- 曜日ヘッダー: `<th scope="col">`
- キーボードナビゲーション対応（矢印キーで日付移動、Enter/Spaceで選択）

## パフォーマンス

- 初期表示: 2秒以内
- 日別データ一括取得（月全体）
- データキャッシュ（同一年月・閾値の場合は再利用）

## エラーハンドリング

### APIエラー
- 400 Bad Request: "年月の形式が正しくありません"
- 500 Server Error: "サーバーエラーが発生しました"
- エラーメッセージをトースト表示
- 再試行ボタン表示

### データなし
- "該当する日別データがありません"
- 月選択へ戻るリンク表示

## テスト観点

### 表示テスト
- [ ] パンくずリストが表示される
- [ ] ページタイトルに年月が表示される
- [ ] 前月/翌月ボタンが表示される
- [ ] カレンダービューで日付と エントリー数が表示される
- [ ] 曜日ヘッダーが表示される（日〜土）
- [ ] 当日がハイライト表示される

### 機能テスト
- [ ] 日付セルをクリックすると新着/人気エントリー一覧に遷移する
- [ ] 新着順リンクをクリックすると新着順エントリー一覧に遷移する
- [ ] 人気順リンクをクリックすると人気順エントリー一覧に遷移する
- [ ] 前月ボタンで前月の日別アーカイブが表示される
- [ ] 翌月ボタンで翌月の日別アーカイブが表示される
- [ ] 閾値フィルタを変更するとエントリー数が更新される
- [ ] カレンダービュー/リストビュー切り替えが動作する

### レスポンシブテスト
- [ ] PC表示でカレンダービューが適切
- [ ] SP表示でカレンダービューが縮小される
- [ ] リストビューが1列表示される（SP）

### パフォーマンステスト
- [ ] 初期表示が2秒以内
- [ ] 月切り替えがスムーズ

## 備考
- カレンダービューとリストビューの切り替え機能は将来的な拡張として検討
- ヒートマップ表示はビジュアライゼーションの一環として検討
