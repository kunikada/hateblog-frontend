# アーカイブ

## 画面概要
- **画面名**: アーカイブ
- **URL**: `/archive`
- **目的**: 全期間の日別エントリー件数を1ページで一覧表示し、特定の日付のエントリーへアクセス

## レイアウト構成

### ページヘッダー
- ページタイトル: "アーカイブ"
- 説明文: "過去のエントリーを日付で探す"
- 総エントリー数表示（全期間）
- 年フィルタ（オプション）

### フィルタ／ソート
- 年選択ドロップダウン（全期間/2024/2023/.../2005）
- ソート順: 日付降順（デフォルト）/ 日付昇順 / エントリー件数降順

### メインコンテンツ
- 日別エントリー件数テーブル
  - 日付（YYYY-MM-DD形式）
  - エントリー件数
  - 件数バーグラフ（視覚化）
  - クリックで該当日のエントリー一覧へ遷移
- 仮想スクロール対応（大量データのパフォーマンス最適化）

### ページネーション（オプション）
- 無限スクロール または ページネーション（100件ずつ）

## テーブル行構成

### 表示要素
- 日付（左）: 例: "2024-12-15（日）"
- エントリー件数（中央）: 例: "1,234 件"
- バーグラフ（右）: 件数に応じた長さの横棒グラフ
  - 最大件数を100%として相対的な長さ
  - バーの色: Hatebuブルー
  - ホバー時: 詳細情報をツールチップ表示

### レイアウト
- PC: テーブル形式（3列）
- タブレット: テーブル形式（2列、バーグラフは省略可）
- SP: リスト形式（日付とエントリー件数を縦並び）

### インタラクション
- ホバー時: 行全体をハイライト表示
- クリック: `/entries/{YYYYMMDD}/hot` へ遷移（該当日の人気エントリー一覧）

## API連携

### 初期表示（全日別エントリー件数取得）
```
GET /api/v1/archive
```

#### クエリパラメータ（オプション）
- `year`: 特定年のみ取得（省略時は全期間）
- `limit`: 取得件数（デフォルト: 100）
- `offset`: オフセット（ページネーション用）

#### レスポンス
```json
{
  "items": [
    {
      "date": "2024-12-15",
      "count": 1234,
      "day_of_week": "日"
    },
    {
      "date": "2024-12-14",
      "count": 1156
,
      "day_of_week": "土"
    }
    // ...
  ],
  "total": 7305,
  "limit": 100,
  "offset": 0,
  "max_count": 5678
}
```

### パフォーマンス最適化
- 初回は直近100件のみ取得
- スクロールに応じて追加データを取得（無限スクロール）
- または年フィルタで絞り込んでデータ量を削減

## インタラクション

### 年フィルタ選択
1. 年ドロップダウンをクリック
2. 年を選択（全期間/2024/2023/...）
3. 選択年のデータのみテーブルに表示
4. URLパラメータ更新: `?year={year}`

### ソート順変更
1. ソートボタンをクリック
2. ソート順を選択
   - 日付降順（新しい順）
   - 日付昇順（古い順）
   - エントリー件数降順（多い順）
3. テーブルを再ソート

### テーブル行クリック
1. 行をクリック
2. `/entries/{YYYYMMDD}/hot` に遷移（該当日の人気エントリー一覧）
3. 閲覧履歴をlocalStorageに保存（オプション）

## 状態管理

### ローカルステート
- 選択年フィルタ（selectedYear: null | number）
- ソート順（sortOrder: 'date_desc' | 'date_asc' | 'count_desc'）
- アーカイブデータ（archiveData: ArchiveItem[]）
- 総件数（total）
- 最大エントリー件数（maxCount、バーグラフの基準値）
- ローディング状態（isLoading）
- エラー状態（error）

### グローバルステート
- なし（ページ固有のデータ）

## デザインガイドライン

### テーブル
- 背景: 白（ライト）/ ダークグレー（ダーク）
- ボーダー: 1px solid #DDD（行間）
- パディング: 16px
- ホバー時: 行全体の背景色を変更（#F5F5F5）
- フォントサイズ: 16px

### 日付表示
- フォントウェイト: Medium
- カラー: ブラック（ライト）/ ホワイト（ダーク）
- 曜日: グレー（#666）

### エントリー件数
- フォントサイズ: 18px
- フォントウェイト: Bold
- カラー: Hatebuブルー

### バーグラフ
- 高さ: 8px
- 角丸: 4px
- カラー: Hatebuブルー（グラデーション）
- アニメーション: 初期表示時に左から右へアニメーション
- ホバー時: 不透明度を上げる

## アクセシビリティ

- テーブル: `<table>` タグを使用
- 各行: `role="link"` または `<a>` タグでラップ
- 日付: `<time>` タグを使用
- エントリー件数: `aria-label="{date}のエントリー件数: {count}件"`
- キーボードナビゲーション対応（Tab/Enter）
- ソートボタン: `aria-label="ソート順: {current_sort}"`

## パフォーマンス

- 初期表示: 2秒以内
- 仮想スクロール実装（react-window等）で大量データに対応
- 無限スクロールで段階的にデータ取得
- 年フィルタでデータ量を削減
- データキャッシュ（年単位でキャッシュ）

## エラーハンドリング

### APIエラー
- 500 Server Error: "サーバーエラーが発生しました"
- エラーメッセージをトースト表示
- 再試行ボタン表示

### ネットワークエラー
- "ネットワークに接続できません"
- オフライン検知
- 再試行ボタン表示

### データなし
- "該当期間のアーカイブデータがありません"
- フィルタ条件をクリアする提案表示

## テスト観点

### 表示テスト
- [ ] ページタイトル"アーカイブ"が表示される
- [ ] 日別エントリー件数テーブルが表示される
- [ ] 日付、エントリー件数、バーグラフが正しく表示される
- [ ] 年フィルタが表示される
- [ ] ソートボタンが表示される

### 機能テスト
- [ ] 年フィルタを変更するとテーブルが絞り込まれる
- [ ] ソート順を変更するとテーブルが再ソートされる
- [ ] テーブル行をクリックすると該当日のエントリー一覧ページに遷移する
- [ ] 無限スクロールで追加データが読み込まれる
- [ ] バーグラフの長さがエントリー件数に比例している

### レスポンシブテスト
- [ ] PC表示でテーブル形式（3列）
- [ ] タブレット表示でテーブル形式（2列）
- [ ] SP表示でリスト形式

### パフォーマンステスト
- [ ] 初期表示が2秒以内
- [ ] 大量データ（1000件以上）でもスクロールがスムーズ
- [ ] 仮想スクロールが機能する

## 備考
- 全期間の日別エントリー件数を1ページで表示するため、仮想スクロールが重要
- データ量が多い場合は年フィルタで絞り込むことを推奨
- バーグラフで視覚的にエントリー件数の傾向を把握しやすくする
- 将来的には月別サマリーやヒートマップ表示も検討可能
