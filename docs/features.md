# hateblog フロントエンド設計メモ

## アーキテクチャ
- フロントエンド／バックエンド分離の SPA 構成
- API サーバーは一覧・詳細・ランキング・検索・タグ・アーカイブ・履歴などのデータ提供を担当
- レスポンシブ対応（スマホ・タブレット・PC）
- ログイン機能なし（履歴はブラウザローカルで保持する方針）
- API は REST で提供し、OpenAPI でスキーマ管理・型生成を行う

## パフォーマンス・運用
- 軽量でリソース消費を抑える設計（キャッシュ活用、必要最小限のデータ返却）
- 負荷分散／スケールを考慮した設計（ページネーション・クエリ最適化・キャッシュキー設計）
- 共有は Web Share API + SNS 公式シェア URL の組み合わせ。外部スクリプト（ウィジェット系）は極力使わず、使う場合も遅延ロードで最小化
- アナリティクス計測は Google Analytics 4（GA4）で実施

## データ要件（機能を支えるもの）
- エントリー：タイトル、リンク先 URL、投稿日、はてブ件数、抜粋、タグ一覧、favicon URL、共有用メタデータ
- フィルタ：はてブ件数の閾値パラメータ
- 日付軸：日付ごとの新着／人気、アーカイブ（年→月→日）、ランキング（年→月→週）
- タグ軸：タグ別一覧取得
- 検索：キーワード検索 API（対象フィールドは別途定義）
- 閲覧履歴：localStorage に保存＋表示用データ構造（サーバー側保存は行わない方針）
- クリック計測：記事クリックを記録する計測 API（エントリー ID をキー）

## UI/デザイン検討メモ

### トップ/共通レイアウト
- ファーストビューにロゴ・説明文・検索フォームを集約し、下層リストへの導線が視認できるヒーロー構成とする。
- 色は Hatebu ブルー＋モノクロをベースにし、タグや favicon、共有アイコンといったアクセントは余白を確保して情報密度を調整。
- ダークモードを初期対応候補に含め、夜間閲覧の可読性を確保する。

### ナビゲーション設計
- グローバルナビに「新着・人気・アーカイブ・ランキング・閲覧履歴」をタブ表示（PC では水平タブ、SP ではスワイプタブ＋ハンバーガー）。
- アーカイブの年→月→日階層はモーダルやツリー式のナビ、ランキングは年→月→週の階層リンクで辿れるようにする。

### リスト／カード UI
- エントリーはカード型（PC 2列／SP 1列）で、favicon・タグ・抜粋・共有アクションを縦方向に整理し、カード全体をクリック領域とする。
- ブックマーク追加、共有リンク群はカード右上のアイコンバーにまとめ、hover やタップでツールチップ表示。
- 「続きを読む」はカード右下に補助リンクとして配置、クリック計測 API をカード押下時に発火する。

### フィルタ／検索
- はてなブックマーク件数の閾値チップ（5/10/50…）をリスト上部に設置し、複数選択や「クリア」操作を支援。SP では横スクロールのチップ。
- 検索フォームはトップと一覧で共通コンポーネント化し、全文/タイトル/タグ検索種別をセレクタで切り替える。

### ランキング・アーカイブ表示
- 日別件数をヒートマップやカレンダーで視覚化し、アーカイブから新着/人気リストへ遷移できる導線を併記。
- ランキングカードには順位バッジと Hatebu 件数を強調し、年次ページのヒーローには年間トピックを掲載。

### 閲覧履歴とタグ
- 閲覧履歴タブには localStorage ベースである旨の注記と、期間スライダー／履歴削除ボタンを用意してプライバシー配慮を示す。
- タグページはヘッダーにタグ説明と関連タグバッジ、カード UI は一覧と統一して情報を再利用する。

### インタラクション
- 共有やタグクリックの操作性を上げるため、カード内のアイコン押下にはマイクロアニメーションを入れてフィードバックを出す。
- リスト切り替え時には骨格スクリーンを表示し、バックエンドの更新待ち時間を自然に吸収する。

## 機能要素（フロントエンド関連抜粋）

### 共通
- サイトロゴ・説明文の表示
- キーワード検索フォーム（テキスト入力＋検索実行）
- グローバルナビゲーション：新着順リスト、人気順リスト、アーカイブ、ランキング、閲覧履歴（ログインは廃止予定）

### エントリー表示共通要素
- タイトル・外部記事へのリンク（新規タブ想定）
- 投稿日時表示
- はてなブックマーク件数の表示
- ブックマーク追加リンク（はてな）
- 共有／保存：Web Share API + SNS 公式シェア URL（Twitter、Facebook、Pocket、Instapaper、Evernote など必要最小限）
- タグ一覧表示＋タグ別一覧ページへの導線
- 記事本文冒頭の抜粋＋「続きを読む」で元記事へ
- favicon 表示（記事ドメインに紐づくアイコン取得）
- クリック計測（リストからのクリックを計測するエンドポイント呼び出し）

### リスト／フィルタ
- 新着順リスト：指定日付のエントリー一覧
- 人気順リスト：指定日付のエントリーを人気順に並べた一覧
- はてなブックマーク件数による閾値フィルタ（例：5/10/50/100/500/1000 users）を共通で適用可能
- ページネーションは再考前提（25件固定などの仕様は引き継がない）

### アーカイブ
- 年→月→日での階層ナビゲーション
- 日単位での件数表示
- 各日付から新着順／人気順リストへのリンク
- 閾値フィルタ（5〜1000 users）の適用

### ランキング
- 年次「はてブ・オブ・ザ・イヤー」ページ
- 月間ランキング TOP 5、週間ランキング TOP 3 のリンク
- 年→月→週の階層リンクで各ランキングページに遷移

### 閲覧履歴
- ユーザーの閲覧履歴を保存し、一覧表示（ログインなし前提、localStorage で保持）
- 期間表示（例：表示範囲の日付）
- ページ遷移（ページネーション仕様は再考）
- エントリー表示要素はリストと同等（共有・タグ・続きを読む等）

### タグ
- タグ別一覧ページ（`/tag/{tag}`）の提供
- エントリーからのタグクリックで遷移可能

### 検索
- キーワード検索フォーム（サイト内エントリーの全文／タイトル／タグ検索いずれかは別途定義）

### アナリティクス（GA4）
- Google Analytics 4 による計測を Google Tag Manager（GTM）経由で導入
- `react-gtm-module` を使用して React アプリに GTM を組み込む
- GTM ID は環境変数（`VITE_GTM_ID`）で管理し、未設定時は GTM スクリプトを読み込まない
- GA4 のイベント設定・トリガー管理は GTM 管理画面側で行い、フロントエンドからは `dataLayer.push` でイベントデータを送信
- 計測イベント（`dataLayer.push` で送信）：
  - ページビュー（`page_view`）：TanStack Router のルート遷移時に送信
  - 記事クリック（`select_content`）：エントリーカードのクリック時に送信（エントリー ID・タイトル・URL をパラメータに含む）
  - 共有（`share`）：共有ボタン押下時に送信（共有先・エントリー ID をパラメータに含む）
  - 検索（`search`）：検索実行時に送信（検索キーワードをパラメータに含む）
  - フィルタ変更（カスタムイベント `filter_change`）：はてブ閾値フィルタ変更時に送信
- Cookie 同意バナーは初期リリースでは対象外（必要に応じて後日対応）
